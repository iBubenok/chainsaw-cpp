# DEC-0001 — Стратегия репозитория и синхронизации с upstream

## Контекст
- Проект: портирование Chainsaw (Rust) → C++ с требованием эквивалентности наблюдаемого поведения 1:1 и кроссплатформенности.
- На входе имеются архивы: `chainsaw.zip`, `sigma.zip`, `EVTX-ATTACK-SAMPLES.zip`, а также план работ и операционные правила.
- На момент принятия решения:
 - baseline (версия/коммит upstream) ещё не зафиксирован (это будет сделано в шагах 2–3);
 - лицензии компонентов и датасетов ещё не проанализированы (это будет сделано в шаге 4);
 - политика хранения тестовых данных в репозитории ещё не определена (это будет сделано в шаге 28).

## Решение
1) Создать **отдельный репозиторий** для порта C++ с рабочим названием:
 - имя: `ambrella-chainsaw-cpp`
 - краткое описание: «Порт Chainsaw (Rust) на C++ с эквивалентностью поведения 1:1 и кроссплатформенностью»

2) В репозитории вести два независимых контура:
 - `upstream/` — фиксированный снимок upstream-материалов, используемый для анализа и доказательств;
 - `cpp/` — реализация порта.

3) Upstream-материалы до завершения шага 4 (лицензии) и шага 28 (политика данных):
 - **не коммитить** крупные датасеты и архивы;
 - хранить их как внешние входы проекта (артефакты Projects/CI) и фиксировать происхождение через реестры и baseline-паспорт.

4) Стратегия синхронизации с upstream:
 - На шаге 3 зафиксировать baseline (коммит/релиз/версия) по извлекаемым метаданным.
 - После определения baseline и лицензий (шаги 3–4) выбрать механизм фиксации исходников в `upstream/`:
 - либо git-submodule на официальный upstream-репозиторий с привязкой к коммиту,
 - либо git-subtree/вендоринг исходников с сохранением provenance.
 - До шага 4 любые действия с переносом исходников в репозиторий ограничиваются **только структурными заглушками**.

## Альтернативы
A) Форк upstream Chainsaw и разработка порта в ветке форка.
- Плюсы: прямой remote, удобнее синхронизировать изменения upstream.
- Минусы: смешение контуров Rust/C++ в одном репозитории, риск «случайных» изменений в upstream-коде, сложнее держать доказательную инфраструктуру и данные отдельно.

B) Два репозитория: один для upstream-снимка и доказательств, второй для C++.
- Плюсы: максимальная изоляция.
- Минусы: усложнение трассируемости и воспроизводимости сравнительных прогонов (harness, golden runs).

## Обоснование выбора
- Отдельный репозиторий под порт позволяет:
 - явно разделить upstream-код (как источник истины) и C++ реализацию;
 - централизованно хранить доказательные артефакты (harness/диффы/протоколы) вместе с реализацией;
 - не «подмешивать» большие данные и материалы до формализации лицензионной и data-политики.

## Последствия
- До шагов 3–4 в `upstream/` остаются только заглушки и ссылки на входные артефакты.
- После шагов 3–4 потребуется уточняющее решение (ADR) о конкретном механизме синхронизации с upstream.

## Критерии проверки/пересмотра
- Если в шаге 4 лицензии потребуют обязательного включения текста лицензий/атрибуции в репозиторий — структура будет обновлена.
- Если в шаге 28 политика данных допустит хранение части датасетов в репозитории — будет введён управляемый каталог фикстур и правила `.gitignore` будут уточнены.
