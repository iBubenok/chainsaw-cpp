# ADR-0008 — Фреймворк модульных тестов для C++

## Статус
- Дата: 2026-01-02
- Статус: Accepted
- Контекст To‑Be: `TESTMAT-0001`, `AR-0001`, `ARCH-0002`
- Связанные требования: `REQ-OPS-0023`, `REQ-OPS-0027`, `REQ-OPS-0028`, `REQ-NFR-0013`
- Связанные риски: `RISK-0021`

## Контекст
Порт должен получить test-to-test сопоставимость с upstream Rust тестами (см. `TESTMAT-0001`, `TASK-0001`).

Матрица вариантов `ARCH-0002` (категория D1) рассматривает GoogleTest, Catch2, doctest.

## Решение
1) Принять **GoogleTest (gtest)** как базовый фреймворк для модульных и интеграционных тестов C++.

2) Подключение gtest выполняется офлайн через стратегию `ADR-0002` (vendoring), без сетевой зависимости.

## Альтернативы
A) Catch2
- Плюсы: header-only, удобный синтаксис.
- Минусы: “одним заголовком” решает не все задачи; при росте тестовой базы может потребовать дополнительных компонентов.

B) doctest
- Плюсы: очень лёгкий.
- Минусы: менее богатая экосистема и возможности на уровне отчётности/интеграции.

## Обоснование
- GoogleTest де-факто стандарт в C++ экосистеме и хорошо интегрируется с CMake (`ADR-0001`).
- Удобен для переноса тест‑матрицы: параметризованные тесты, хорошие ассерты, совместимость с CI.

## Последствия
- В To‑Be архитектуре тестовая подсистема (`cpp/tests` и т.п.) должна быть выстроена вокруг gtest.
- gtest должен быть отражён в `LIC-0002` и подключён через vendoring.

## План верификации
- –26: базовый `ctest` прогон должен работать локально и в CI.
-: перенос `TST-0001…TST-0022` должен быть реализован на базе gtest или эквивалентных проверок.

## Условия пересмотра
- Если офлайн‑интеграция gtest окажется существенно проблемной на целевых ОС.
- Если появится формальное требование минимизировать сторонние зависимости в тестовой части (при сохранении `REQ-OPS-0027`).
