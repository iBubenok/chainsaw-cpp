# ADR-0001 — Система сборки и стандарт C++

## Статус
- Дата: 2026-01-02
- Статус: Accepted
- Контекст To‑Be: `TASK-0001`, `AR-0001`, `ARCH-0002`
- Связанные требования: `REQ-OPS-0023`, `REQ-NFR-0012`, `REQ-OPS-0028`, `REQ-OPS-0029`
- Связанные риски: `RISK-0021`, `RISK-0032`

## Контекст
Порт Chainsaw должен иметь воспроизводимый цикл `configure → build → test` и собираться на Windows/Linux/macOS.

На этапе выбора базовых решений доступны:
- требования `AR-0001` (в т.ч. `REQ-OPS-0023`, `REQ-NFR-0012`, `REQ-OPS-0028`);
- матрица вариантов `ARCH-0002` (категория F: build/packaging/deps);
- ограничения Projects/CI как основной способ получения доказательств (см. `RISK-0021`).

## Решение
1) **Система сборки:** принять **CMake** как единственный обязательный build‑инструмент проекта C++.

2) **Стандарт языка:** установить базовый стандарт **C++17** для всего C++ кода порта.

3) **Правило по сетевым зависимостям:** сборка по умолчанию **не должна требовать сети** (детали механизма управления зависимостями закрепляются отдельным решением; см. `ADR-0002`).

## Альтернативы
A) Meson
- Плюсы: современный UX, быстрые конфигурации.
- Минусы: меньше распространён в экосистеме C++ DFIR/ИБ, меньше “дефолтной” поддержки во внешних окружениях.

B) Bazel
- Плюсы: сильная модель воспроизводимости.
- Минусы: высокая стоимость внедрения, нет необходимости для текущего масштаба; усложняет офлайн‑использование и интеграцию C/C++ зависимостей (см. `RISK-0032`).

C) C++20 как базовый стандарт
- Плюсы: современный стандарт, дополнительные языковые/библиотечные возможности.
- Минусы: неоднородность поддержки на целевых платформах/стандартных библиотеках может увеличить риск сборки и усложнить “минимально собираемый скелет”.

## Обоснование
- CMake является наиболее распространённым и ожидаемым инструментом в кроссплатформенном C++‑разработке; упрощает дальнейшее подключение CI матрицы и внешних зависимостей.
- Базовый стандарт C++17 даёт необходимые фундаментальные возможности (включая `std::filesystem`) и снижает риск несовместимости toolchain на целевых ОС.
- Требование офлайн‑сборки следует из `REQ-OPS-0028` и ограничений на воспроизводимость в средах без доступа в Интернет.

## Последствия
- Все последующие решения по зависимостям и инфраструктуре (–26) должны быть совместимы с CMake и C++17.
- Если в будущем появится необходимость поднять стандарт (например, для конкретной платформенной абстракции), это оформляется отдельным ADR с указанием причины и влияния на CI.

## План верификации
-: минимальный C++‑скелет должен успешно конфигурироваться и собираться хотя бы в одной целевой среде.
-: CI‑матрица должна подтверждать сборку/тесты на Windows/Linux/macOS.

## Условия пересмотра
- Если выбранные зависимости (см. `ADR-0002` и последующие) требуют стандарта выше C++17 и это невозможно обойти без ущерба требованиям `REQ-*`.
- Если CI/полевые прогоны выявят, что CMake не обеспечивает воспроизводимость/кроссплатформенность на целевых окружениях (в этом случае требуется замена или усиление правил).
