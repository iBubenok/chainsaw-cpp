# POL-0001 — Политика сторонних компонентов и данных

## Цель
Установить проверяемые правила работы со сторонними компонентами (код/данные/документация) для проекта портирования Chainsaw (Rust) → C++.

## Объём
Политика распространяется на:
- upstream-исходники/данные/0005/0006), используемые как **источник истины** поведения;
- любые будущие внешние зависимости C++ реализации;
- тестовые данные/фикстуры, которые будут добавляться в репозиторий.

Политика **не** заменяет юридическую экспертизу; в спорных случаях действует принцип: «не включать в репозиторий без явной лицензии и согласования».

## Связанные документы
- `docs/licensing/LIC-0001-upstream-licenses.md` — реестр лицензий входных upstream-источников
- `docs/baseline/BASELINE-0001-upstream.md` — baseline коммиты/происхождение upstream

---

## POL-RULES

### POL-001 — Единый реестр лицензий (single source of truth)
1) Любой сторонний компонент, который **попадает в репозиторий** (код/данные/доки/скрипты/встроенные ресурсы), должен быть отражён в:
 - `docs/licensing/LIC-0001-upstream-licenses.md` (для upstream-источников) **или**
 - отдельном реестре лицензий для зависимостей (будет введён после, когда появятся выбранные библиотеки).

2) Для каждого компонента в реестре должны быть:
 - upstream URL (или первоисточник),
 - версия/commit/tag (если применимо),
 - лицензия (название + по возможности SPDX),
 - ссылка на файл лицензии/NOTICE,
 - краткое описание обязательств (атрибуция/распространение/ограничения).

**Проверка:** любое добавление внешнего компонента без записи в реестр считается дефектом.

### POL-002 — Базовая лицензия репозитория порта
1) Upstream Chainsaw распространяется под GNU GPL v3 (см. `LIC-0001`). Как минимум часть будущей реализации является производной работой (портирование поведения по исходникам).

2) В качестве рабочего дефолта репозиторий порта должен содержать файл `LICENSE` с текстом GNU GPL v3.

3) Если будет принято иное юридическое решение (например, коммерческая лицензия/исключение/clean-room стратегия), оно фиксируется отдельным решением (DEC/ADR) с обоснованием и планом миграции.

**Проверка:** наличие `LICENSE` в корне и отсутствие противоречий между лицензией репозитория и реестром лицензий.

### POL-003 — Правила переноса кода (код → код)
1) По умолчанию портирование выполняется как **переписывание** (behavioral port), а не копирование кода.
2) Если по каким-то причинам требуется перенести фрагмент upstream-текста (код/таблица/описание):
 - фиксировать provenance (upstream URL + commit + путь файла + диапазон строк) рядом с использованием (комментарий в коде или запись в документе);
 - сохранять все существующие upstream-уведомления об авторских правах/лицензии, если они присутствуют в исходнике;
 - избегать «слепого» копирования больших фрагментов без необходимости.

**Проверка:** код-ревью на предмет provenance и соблюдения лицензий.

### POL-004 — Sigma rules (DRL 1.1): сохранность метаданных и атрибуция
1) При обработке Sigma-правил запрещено:
 - удалять/перезаписывать поле `author`;
 - удалять идентификаторы/ссылки, которые используются для атрибуции (например, `id`, `references`, `related`, `tags`), если они присутствуют в правилах.

2) Если в рамках работы/тестов потребуется включать Sigma-правила (или их подмножество) в репозиторий:
 - сохранять правила в оригинальном виде (кроме вынужденных технических правок, которые должны быть документированы),
 - сохранять ссылку на upstream и baseline commit,
 - при распространении правил вместе с репозиторием — обеспечить наличие текста/ссылки на DRL 1.1 и сохранение `author`/URI.

3) Сообщения/результаты, сформированные на основе срабатываний Sigma-правил, должны сохранять идентификацию автора правила, если она присутствует в правиле.

**Проверка:**
- в /13/27 — сверка наблюдаемого поведения Chainsaw и проверка, что вывод включает достаточную информацию для DRL (не меняя формат 1:1);
- добавление регрессионного теста на сохранение `author` (планируется после появления парсинга Sigma в C++).

### POL-005 — EVTX-ATTACK-SAMPLES и другие датасеты
1) До формализации политики тестовых данных **не коммитить** крупные датасеты целиком.
2) Если по требованиям тестов потребуется добавить в репозиторий минимальные фикстуры (подмножество EVTX):
 - хранить их в выделенном каталоге фикстур (будет определён в ),
 - сохранять файл лицензии и ссылку на upstream,
 - фиксировать, какие именно файлы включены и почему (трассировка: тест → фикстура → upstream).

**Проверка:** наличие лицензии рядом с фикстурами и запись в реестр.

### POL-006 — Требования к лицензиям будущих C++ зависимостей
До выбора библиотек фиксируются только критерии допустимости:

**Разрешены (по умолчанию):**
- OSI-approved лицензии, совместимые с GPL v3 (пермишсивные MIT/BSD/Apache-2.0 и т.п. — после проверки совместимости).

**Запрещены без отдельного решения и юридической проверки:**
- проприетарные/закрытые лицензии;
- лицензии с ограничениями по области применения (field-of-use), запретом коммерческого использования и т.п.;
- лицензии без текста/без явного правообладателя;
- зависимости, требующие принятия условий, несовместимых с GPL-обязательствами проекта.

**Проверка:** перед добавлением зависимости — запись в реестр + наличие текста лицензии/NOTICE + явная фиксация версии.

---

## Минимальный чек-лист при добавлении стороннего компонента
1) Есть лицензия и она совместима с текущим режимом проекта.
2) Компонент внесён в реестр лицензий.
3) В репозитории присутствует текст лицензии и/или NOTICE (если требуется лицензией).
4) Зафиксированы provenance: источник + версия/commit.
5) Если компонент влияет на вывод/форматы — предусмотрены тесты/дифф для 1:1.
