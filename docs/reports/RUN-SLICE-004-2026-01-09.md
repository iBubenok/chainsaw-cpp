# RUN-SLICE-004 — File Discovery

## Метаданные

| Параметр | Значение |
|----------|----------|
| **Slice** | SLICE-004 |
| **Дата** | 2026-01-09 |
| **Шаг** | |
| **Статус** | UnitDone PASS |

## Созданные артефакты

| Артефакт | Путь | Описание |
|----------|------|----------|
| Header | `cpp/include/chainsaw/discovery.hpp` | API discover_files, DiscoveryOptions |
| Implementation | `cpp/src/io/discovery.cpp` | Реализация рекурсивного обхода, фильтрации, сортировки |
| Unit tests | `cpp/tests/test_discovery_gtest.cpp` | 21 тест (TST-DISC-001..012 + дополнительные) |
| CMake | `cpp/CMakeLists.txt` | Добавлен chainsaw_discovery |
| CMake tests | `cpp/tests/CMakeLists.txt` | Добавлен test_discovery_gtest |

## Результаты сборки

| Платформа | Компилятор | Результат |
|-----------|------------|-----------|
| Linux (Debian) | GCC 14.2.0 | PASS |
| macOS (arm64) | AppleClang 17.0.0 | PASS |
| Windows 11 | MSVC 19.44.35222.0 | PASS |

## Результаты тестирования

| Платформа | Всего тестов | Пройдено | Провалено |
|-----------|--------------|----------|-----------|
| Linux | 136 | 136 | 0 |
| macOS | 136 | 136 | 0 |
| Windows | 136 | 136 | 0 |

### Покрытие тестов TST-DISC-*

| ID | Название | Статус |
|----|----------|--------|
| TST-DISC-001 | SingleFile_MatchingExtension | PASS |
| TST-DISC-002 | SingleFile_NonMatchingExtension | PASS |
| TST-DISC-003 | EmptyDirectory | PASS |
| TST-DISC-004 | Directory_MixedExtensions | PASS |
| TST-DISC-005 | RecursiveTraversal | PASS |
| TST-DISC-006 | NoExtensionFilter | PASS |
| TST-DISC-007 | NonExistentPath_SkipErrors | PASS |
| TST-DISC-008 | NonExistentPath_ThrowsError | PASS |
| TST-DISC-009 | SpecialCase_MFT | PASS |
| TST-DISC-010 | PathWithSpaces | PASS |
| TST-DISC-011 | DeterministicOrder | PASS |
| TST-DISC-012 | ExtensionCaseSensitive | PASS |

### Дополнительные тесты

- `TST_DISC_009_MFT_NotMatchedWithoutExtension` — проверка что $MFT не добавляется если не в extensions
- `TST_DISC_010_MultipleSpaces` — множественные пробелы в путях
- `TST_DISC_011_SortedAcrossDirectories` — сортировка между директориями
- `TST_DISC_012_MultipleExtensionCases` — несколько регистров в extensions
- `MultipleInputPaths` — несколько входных путей
- `MultipleExtensions` — фильтрация по нескольким расширениям
- `FileWithNoExtension` — файл без расширения
- `EmptyInputVector` — пустой вектор входов
- `SingleFileAsInput` — одиночный файл как вход

## Верификация по инвариантам SPEC-SLICE-004

| Инвариант | Описание | Статус |
|-----------|----------|--------|
| INV-001 | Расширения сравниваются без точки | PASS |
| INV-002 | $MFT добавляется если в extensions | PASS |
| INV-003 | Результат отсортирован (ADR-0011) | PASS |
| INV-004 | Рекурсивный обход поддиректорий | PASS |
| INV-005 | skip_errors → предупреждения в stderr | PASS |
| INV-006 | Пустой результат не ошибка | PASS |

## Итого

- **Статус:** UnitDone PASS
- **Прирост тестов:** 115 → 136 (+21 тест)
- **Новые модули:** chainsaw_discovery
- **Риски покрыты:** RISK-0007 (пути с пробелами) — протестировано

## Трассировка

- SPEC-SLICE-004 → discover_files реализация
- ADR-0010 → std::filesystem::path
- ADR-0011 → детерминированная сортировка результатов
- RISK-0007 → тесты TST-DISC-010
