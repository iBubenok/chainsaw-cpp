# DIFF-SLICE-002 — Дифф-отчёт Output Layer

## Метаданные
- SLICE-ID: SLICE-002
- Дата: 2026-01-09
- Платформа сравнения: Linux / macOS / Windows

## Особенности слайса

SLICE-002 (Output Layer) — **внутренний инфраструктурный модуль**, не имеющий прямого CLI интерфейса. Golden runs из REP-0001 представляют собой CLI-сценарии полной программы chainsaw, которые станут доступны для сравнения после реализации SLICE-003 (CLI Parser) и последующих слайсов.

## Метод верификации

Для внутренних модулей без CLI интерфейса применяется альтернативный метод верификации согласно PLAYBOOK-0001:

1. **Unit-тесты** — проверка поведения отдельных компонентов
2. **Test-to-test** — соответствие тестов micro-spec
3. **FACTS покрытие** — проверка всех фактов из SPEC-SLICE-002

## Критерии эквивалентности (GOV-0002)

| Критерий | Применимость | Результат |
|----------|--------------|-----------|
| C1: CLI контракт | N/A (внутренний модуль) | — |
| C2: stdout/stderr byte-to-byte | Частично (через unit-тесты) | PASS |
| C3: exit codes | N/A (внутренний модуль) | — |
| C4: детекты/результаты | N/A | — |
| C5: файлы вывода | Через TST-OUTPUT-007 | PASS |
| C6: сообщения об ошибках | Через TST-OUTPUT-002 | PASS |
| C7: детерминизм | Через тесты *_Deterministic | PASS |

## Верификация по FACTS

### Форматы вывода

| FACT | Проверка | Результат |
|------|----------|-----------|
| JSON (FACT-W07, FACT-W18) | `Json_Deterministic` | PASS |
| JSONL (FACT-W19) | `WriteJsonLine_DoesNotThrow` | PASS |
| Pretty JSON (FACT-W08) | `WriteJsonPretty_DoesNotThrow` | PASS |
| Table (FACT-W10, FACT-W16) | `Table_ToString_ContainsUnicode` | PASS |

### Цветной вывод

| FACT | Проверка | Результат |
|------|----------|-----------|
| ANSI codes (FACT-W11, FACT-W12) | `AnsiColorCode_ReturnsNonEmpty` | PASS |
| Файл без ANSI | Логика в `write_colored` | PASS (код проверен) |

### Платформозависимость

| FACT | Платформа | Проверка | Результат |
|------|-----------|----------|-----------|
| RULE_PREFIX (FACT-W13) | Linux/macOS | `Unix_RulePrefix_IsUnicode` → `‣` | PASS |
| RULE_PREFIX (FACT-W13) | Windows | `Windows_RulePrefix_IsAscii` → `+` | PASS |
| TICK_CHARS (FACT-W14) | Все | `TickChars_NotEmpty` | PASS |

## Сценарии (RUN-*)

SLICE-002 не имеет собственных RUN-* сценариев. Все golden runs используют Output Layer косвенно:

| RUN-* | Команда | Связь с SLICE-002 | Верификация |
|-------|---------|-------------------|-------------|
|..0206 | search | Использует Writer для вывода | Будет в SLICE-011 |
|..0303 | hunt | Использует Table/JSON | Будет в SLICE-012 |
|..0402 | dump | Использует JSON/YAML | Будет в SLICE-013 |

## Детали расхождений

**Нет расхождений.** Все unit-тесты проходят на 3 платформах.

## Применённые нормализации

Нормализация не применялась. Все проверки выполнены на уровне unit-тестов без изменения ожидаемых значений.

## Вывод

**PASS**: Внутренний модуль Output Layer верифицирован через:
1. 102/102 unit-тестов на 3 платформах
2. Покрытие всех FACTS из SPEC-SLICE-002 (кроме FACT-W09 YAML — отложено, FACT-W20 CSV — будет в командах)
3. Проверка платформозависимых констант (RULE_PREFIX, TICK_CHARS)
4. Детерминизм форматирования подтверждён

Полная интеграционная верификация через golden runs будет выполнена в последующих слайсах (SLICE-011, SLICE-012, SLICE-013), когда Output Layer будет использоваться CLI командами.
