# REP-0002 — Первичные результаты сравнения Rust vs C++

## Цель

Зафиксировать первичные результаты дифф-сравнения поведения Rust Chainsaw и C++ порта как **базу для регрессий** на последующих шагах портирования.

## Дата

2026-01-09

## Платформы

| Платформа | Сборка | Harness | Примечание |
|-----------|--------|---------|------------|
| Linux (GCC 14.2) | PASS | Выполнен (7 сценариев) | Golden runs доступны |
| macOS (AppleClang 17) | PASS | Базовая проверка | Golden runs отсутствуют |
| Windows (MSVC 19.44) | PASS | Базовая проверка | Golden runs отсутствуют |

## Сводка результатов (Linux)

| Всего | PASS | FAIL | SKIP | Pass Rate |
|-------|------|------|------|-----------|
| 7 | 0 | 7 | 0 | 0.0% |

**Примечание:** 0% совпадений ожидаемо, так как C++ на данный момент содержит заглушки, а не полную реализацию. Этот отчёт фиксирует базовую линию для отслеживания прогресса портирования.

## Результаты по сценариям

| RUN-ID | Описание | Exit | stdout | stderr | Статус |
|--------|----------|------|--------|--------|--------|
| | chainsaw --help | = | X | X | FAIL |
| | chainsaw --version | = | X | = | FAIL |
| | chainsaw (без аргументов) | X | X | X | FAIL |
| | unknown subcommand | X | = | X | FAIL |
| | dump без обязательного path | = | = | X | FAIL |
| | lint --help | = | X | X | FAIL |
| | lint --kind stalker | X | = | X | FAIL |

Легенда: `=` — совпадение, `X` — расхождение.

## Классификация расхождений

### 1. Формат справки (--help)
- **Причина:** C++ использует собственный формат справки, Rust — clap (automatic help generation)
- **Воздействие:** Различия в форматировании, порядке опций, тексте описаний
- **Решение:** Будет исправлено при детальной настройке CLI (слайсы портирования)
- **GOV-0002 C1:** Критерий применим

### 2. Баннер
- **Причина:** C++ выводит ASCII-баннер в stderr для --help, Rust не выводит
- **Воздействие:** Расхождение stderr
- **Решение:** Проверить поведение Rust и скорректировать C++
- **GOV-0002 C2:** Критерий применим

### 3. Exit codes
- **:** Rust=2 (clap convention), C++=0 (показываем справку как успех)
- **:** Rust=2, C++=1 (разная семантика кодов ошибок)
- **:** Rust=2 (ошибка валидации), C++=0 (заглушка не валидирует)
- **Решение:** Унифицировать exit codes согласно CLI-контракту
- **GOV-0002 C3:** Критерий применим

### 4. Версия
- **Причина:** C++ выводит 0.1.0 (текущая dev-версия), Rust — 2.13.1 (upstream)
- **Решение:** Определить стратегию версионирования (ADR требуется)
- **GOV-0002 C1:** Критерий применим

### 5. Сообщения об ошибках
- **Причина:** Различия в формате (префиксы, текст)
- **Пример:** C++ `[x] error:`, Rust `error:` без префикса
- **Решение:** Привести формат сообщений к Rust
- **GOV-0002 C6:** Критерий применим

## Кроссплатформенная проверка (macOS/Windows)

C++ бинарник успешно работает на всех трёх платформах:

```
# macOS
$./chainsaw --help # OK, exit code 0
$./chainsaw --version # chainsaw 0.1.0, exit code 0

# Windows
$ chainsaw.exe --help # OK, exit code 0
$ chainsaw.exe --version # chainsaw 0.1.0, exit code 0
```

Вывод идентичен на всех платформах — кроссплатформенная поддержка подтверждена.

## Артефакты

| Артефакт | Путь | Описание |
|----------|------|----------|
| Harness скрипт | `tools/harness/compare_behavior.py` | Основной скрипт сравнения |
| README harness | `tools/harness/README.md` | Документация использования |
| Результаты Linux | `.local/harness_results/linux_*/` | JSON/MD отчёты, raw diff |
| Golden runs Rust | `golden/rust_golden_runs_linux_x86_64/` | Эталонные прогоны |

## Рекомендации

1. **Фиксация базовой линии:** Текущий отчёт служит базой для отслеживания прогресса. После каждого слайса портирования запускать harness и фиксировать улучшение Pass Rate.

2. **Приоритеты исправлений:**
 - P1: Exit codes (критично для скриптов/автоматизации)
 - P2: Формат ошибок (согласованность с Rust)
 - P3: Формат справки (пользовательский опыт)

3. **Golden runs для других платформ:** При появлении Rust-сборок для macOS/Windows добавить соответствующие golden runs.

4. **Интеграция с CI:** Добавить запуск harness в CI для автоматического отслеживания регрессий.

## Связанные документы

- `GOV-0002-equivalence-criteria.md` — критерии эквивалентности 1:1
- `REP-0001-rust-golden-runs.md` — протокол эталонных прогонов Rust
- `CLI-0001-*` — CLI-контракт Chainsaw

## Заключение

 выполнен. Harness сравнения поведения создан, первичные результаты зафиксированы. C++ заглушки ожидаемо не совпадают с Rust — это будет исправляться в слайсах портирования (-33).
