# GATE-0002 — Review (после )

**Дата:** 2026-01-02

## Решение
**PASS-with-risks**

Порог готовности из выполнен: восстановлены CLI/фичи/As‑Is/форматы/зависимости/тест‑матрица; доступны эталонные прогоны Rust (golden runs) и протокол их воспроизведения; неопределённости формализованы в реестре рисков.

Переход в To‑Be (+) допускается, но ряд рисков P1/P2 должен быть учтён в AR/ADR.

---

## G1 Доказательства (evidence)
Ниже перечислены ключевые источники «поведенческой истины» Rust и артефакты, на которые можно опираться при проектировании/портировании:

1) **CLI‑контракт (As‑Is):**
 - `docs/as_is/CLI-0001-chainsaw-cli-contract.md`

2) **Инвентарь фич и режимов работы:**
 - `docs/as_is/FEAT-0001-feature-inventory.md`

3) **As‑Is архитектура Rust и границы поведения:**
 - `docs/as_is/ARCH-0001-rust-as-is-architecture.md`

4) **Форматы данных и преобразования pipeline:**
 - `docs/as_is/DATA-0001-data-formats-and-transformations.md`

5) **Карта зависимостей Rust и их роль (без выбора C++ аналогов):**
 - `docs/as_is/DEPS-0001-rust-dependencies.md`

6) **Test-to-test база (покрытие тестов Rust без исключений):**
 - `docs/tests/TESTMAT-0001-rust-test-matrix.md`

7) **Эталонные прогоны Rust (golden runs) и протокол воспроизведения:**
 - Протокол/отчёт: `docs/reports/REP-0001-rust-golden-runs.md`
 - Архивы результатов (Projects):
 - `rust_golden_runs_windows_x86_64.zip`
 - `rust_golden_runs_linux_x86_64.zip`
 - `rust_golden_runs_macos_x86_64.zip`

8) **Формализация рисков/неясностей/допущений (As‑Is):**
 -

---

## G2 Проверяемость (verifiability)

1) **Тестовая база Rust:**
 - Полная матрица `TST-*` (SoT) находится в `docs/tests/TESTMAT-0001-rust-test-matrix.md`.
 - Для каждого `TST-*` зафиксированы: upstream тест (путь/функция), входные файлы/фикстуры, эталонные expected outputs, покрываемые фичи (`FEAT-*`) и модули.

2) **Golden runs:**
 - Прогоны оформлены как `RUN-*` сценарии в отчёте `REP-0001` с командами, повторами и ожидаемыми exit codes.
 - Сбор результатов автоматизируется скриптами:
 - `tools/golden_run_simple.py`
 - `tools/golden_runs_full/run_rust_golden_runs.py` + `tools/golden_runs_full/README.md`

3) **Ограничение Projects‑среды:**
 - Сбор/пересъём эталонов Rust в Projects может быть невозможен (см. RISK-0021). Верификация опирается на внешнюю воспроизводимую среду и перенос результатов в Projects как артефактов.

---

## G3 Трассируемость (traceability examples)
На фазе до (AR) «требования» ещё не формализованы как `REQ-*`, поэтому демонстрируются цепочки вида **поведение/фича → тест → доказательство**.

1) **Search (EVTX) → stdout форматы (JSON/JSONL/Std):**
 - Фича: `FEAT-0007`/`FEAT-0009` (см. `FEAT-0001`)
 - Тесты: `TST-0001`, `TST-0002`, `TST-0003` (см. `TESTMAT-0001`)
 - Upstream Rust тест: `chainsaw/tests/clo.rs` (сравнение stdout с expected)
 - Доказательства: expected outputs в `chainsaw/tests/evtx/*` + эталонные прогоны `..` (см. `REP-0001`)

2) **Hunt (Chainsaw rules YAML) → табличный отчёт:**
 - Фича: `FEAT-0003`/`FEAT-0004`
 - Тест: `TST-0004`
 - Upstream Rust тест: `chainsaw/tests/clo.rs` `hunt_r_any_logon` (stdout byte-to-byte)
 - Доказательства: expected output `chainsaw/tests/evtx/clo_hunt_r_any_logon.txt` + `..` (hunt) в `REP-0001`

3) **Sigma load/convert → YAML‑семантика (single и collection):**
 - Фича: `FEAT-0005`
 - Тесты: `TST-0007`, `TST-0008` (+ дополнительные `TST-0009..TST-0022`)
 - Upstream Rust тесты: `chainsaw/tests/convert.rs` и unit‑тесты в `chainsaw/src/rule/sigma.rs`
 - Доказательства: expected YAML в `chainsaw/tests/convert/*` (сравнение YAML объектов)

4) **Analyse SRUM → табличный/JSON вывод:**
 - Фича: `FEAT-0011`
 - Тесты: `TST-0005`, `TST-0006`
 - Доказательства: expected outputs в `chainsaw/tests/srum/*` + `..` в `REP-0001`

---

## G4 Консистентность (SoT и отсутствие дублей)

1) **Single Source of Truth закреплён:**
 - Схема ID/SoT: `docs/governance/GOV-0001-traceability-and-sot.md`
 - Критерии 1:1: `docs/governance/GOV-0002-equivalence-criteria.md`
 - As‑Is поведение Rust: `docs/as_is/*` и `docs/tests/TESTMAT-*`
 - Риски/допущения:

2) **План работ не дублируется в репозитории:**
 - и учитываются как внешние артефакты Projects и зарегистрированы в.

3) **Идентификаторы и реестры:**
 - В восстановлены ссылки на артефакты, которые уже используются в документах (``, ``, ``, `` и т.д.).
 - приведён к схеме `DEC-NNNN` и привязан к файлам `docs/decisions/DEC-*.md`.

---

## Риски на переход (допускаются в следующую фазу)

**P1 (критично):**
- RISK-0003 — политика хранения тестовых данных не определена
- RISK-0006 — не подтверждена синхронизация Chainsaw ↔ Sigma/EVTX datasets
- RISK-0008 — возможный конфликт GPLv3 с моделью распространения/встраивания
- RISK-0009 — требования DRL 1.1 по атрибуции Sigma vs 1:1 вывод
- RISK-0011 — платформенные/недетерминированные элементы вывода усложняют строгий diff

**P2 (важно):**
- RISK-0010 — неопределённость SPDX/вариантов лицензий
- RISK-0014 — семантика `--cache-to-disk` и побочные FS‑эффекты
- RISK-0022 — отсутствие данных для `analyse shimcache` → дыра в coverage
- RISK-0025 — недетерминированные имена/пути (например, MFT data streams)
- RISK-0028 — несогласованность `--no-banner` в Windows эталонах
- RISK-0029 — недостаточная воспроизводимость Windows эталонов (нет git‑метадаты)

**P3 (желательно):**
- RISK-0026 — не покрыта golden runs логика XML‑разбора
- RISK-0027 — допущение: `hex` не влияет на поведение (требует внешней верификации)
