// ==============================================================================
// chainsaw/platform.hpp - MOD-0004: Платформенные абстракции
// ==============================================================================
//
// MOD-0004 platform
// ADR-0010: std::filesystem::path + явные преобразования path <-> UTF-8
// GUIDE-0001 G-010: платформенная специфика только здесь
//
// Назначение:
// - Единый слой преобразования путей и кодировок
// - Определение TTY для stdout/stderr
// - Платформенные утилиты (temp files, env)
//
// ==============================================================================

#ifndef CHAINSAW_PLATFORM_HPP
#define CHAINSAW_PLATFORM_HPP

#include <filesystem>
#include <string>
#include <string_view>

namespace chainsaw::platform {

// ----------------------------------------------------------------------------
// Преобразования путей (ADR-0010)
// ----------------------------------------------------------------------------

/// Создать path из UTF-8 строки
std::filesystem::path path_from_utf8(std::string_view u8str);

/// Преобразовать path в UTF-8 строку (для печати/сериализации)
/// Примечание: на Unix может быть lossy при non-UTF8 путях
std::string path_to_utf8(const std::filesystem::path& p);

// ----------------------------------------------------------------------------
// TTY detection
// ----------------------------------------------------------------------------

/// Проверить, является ли stdout терминалом
bool is_tty_stdout();

/// Проверить, является ли stderr терминалом
bool is_tty_stderr();

// ----------------------------------------------------------------------------
// Платформенные константы (CLI-0001 1.5)
// ----------------------------------------------------------------------------

/// Префикс правил для табличного вывода (Windows: "+", non-Windows: "‣")
const char* rule_prefix();

// ----------------------------------------------------------------------------
// Временные файлы
// ----------------------------------------------------------------------------

/// Создать временный файл с указанным префиксом
/// Возвращает путь к созданному файлу
/// При ошибке выбрасывает std::runtime_error
/// FACT-011, FACT-012: соответствует tempfile::tempfile() в Rust
std::filesystem::path make_temp_file(std::string_view prefix);

// ----------------------------------------------------------------------------
// Информация о платформе
// ----------------------------------------------------------------------------

/// Получить имя операционной системы
std::string os_name();

}  // namespace chainsaw::platform

#endif  // CHAINSAW_PLATFORM_HPP
